# Board 类功能说明文档

## 类概述

**模块：** `srcs.board`

**类名：** `Board`

**设计目的：** `Board` 类是 NumberMatch（数字配对）游戏的核心数据结构，用于管理游戏棋盘的数字状态。该类封装了棋盘的初始化、数字管理、配对判断、消除操作等核心功能，为游戏逻辑提供了完整的数据操作接口。

**棋盘结构说明：** 棋盘采用 9 列网格结构，使用一维列表 `digit_list` 存储数字。列表中的每个元素代表一个格子，0 表示空格（非数字），1-9
表示实际数字。列表按照先行后列的顺序排列，每 9 个元素构成一行。

## 属性说明

### `digit_list`

- **类型：** `list[int]`
- **说明：** 存储棋盘所有数字的一维列表。列表长度为 `9 × 行数`，每个元素为整数：
    - `0` 表示该格子为空（无数字）
    - `1-9` 表示该格子存放的数字
- **示例：** `[1, 5, 3, 0, 9, 2, 4, 6, 8, ...]`

## 方法说明

### `__init__`

```python
def __init__(self)
```

**功能描述：** 初始化 `Board` 实例，创建一个空的棋盘。

**参数：** 无

**返回值：** 无

**使用示例：**

```python
board = Board()
# 创建后 digit_list 为空列表 []
```

---

### `__str__`

```python
def __str__(self) -> str
```

**功能描述：** 返回棋盘的可视化字符串表示。使用 `.` 字符代替 0 显示空格，数字正常显示，每行 9 个元素，以换行符分隔。

**参数：** 无

**返回值：** `str` - 棋盘的可视化字符串表示

**使用示例：**

```python
board = Board()
board.set_board([1, 2, 3, 0, 4, 5, 6, 7, 8, 9])
print(board)
# 输出：
# 1 2 3 . 4 5 6 7 8
# 9 . . . . . . . .
```

---

### `set_board`

```python
def set_board(self, digit_list: list[int]) -> None
```

**功能描述：** 设置棋盘的当前局面。直接用提供的数字列表替换现有的 `digit_list`。

**参数：**

| 参数名          | 类型          | 说明                  |
|--------------|-------------|---------------------|
| `digit_list` | `list[int]` | 表示局面的整数列表，使用 0 表示空格 |

**返回值：** `None`

**使用示例：**

```python
board = Board()
board.set_board([1, 2, 3, 4, 5, 6, 7, 8, 9, 9, 8, 7, 6, 5, 4, 3, 2, 1])
```

---

### `generate_board`

```python
def generate_board(self, size: int) -> None
```

**功能描述：** 生成一个随机数字填充的棋盘。棋盘大小由 `size` 参数指定，每个位置随机填充 1-9 的整数。

**参数：**

| 参数名    | 类型    | 说明         |
|--------|-------|------------|
| `size` | `int` | 棋盘尺寸（格子总数） |

**返回值：** `None`

**使用示例：**

```python
board = Board()
board.generate_board(81)  # 生成 9×9 的完整棋盘
```

---

### `can_match`

```python
@staticmethod
def _can_match(digit1: int, digit2: int) -> bool
```

**功能描述：** 判断两个数字是否满足配对条件。这是配对判断的底层方法，用于检查数字本身是否满足配对要求。

**数字配对规则：** 两个数字可以配对的前提条件（满足任一即可）：

1. **数值相同**：两个位置的数字完全相等
2. **和为 10**：两个位置的数字之和等于 10

**参数：**

| 参数名      | 类型    | 说明    |
|----------|-------|-------|
| `digit1` | `int` | 第一个数字 |
| `digit2` | `int` | 第二个数字 |

**返回值：** `bool` - 如果两个数字满足配对条件则返回 `True`，否则返回 `False`

**使用示例：**

```python
# 数值相同
print(Board._can_match(5, 5))  # True

# 和为10
print(Board._can_match(3, 7))  # True
print(Board._can_match(1, 9))  # True

# 既不相同，和也不为10
print(Board._can_match(3, 6))  # False
print(Board._can_match(2, 3))  # False

# 与0配对（总是返回False，因为0表示空格）
print(Board._can_match(5, 0))  # False
```

**注意：** 此方法为静态私有方法，仅用于判断数字本身是否满足配对条件，不涉及位置和路径检查。

---

### `is_matching`

```python
def _is_matching(self, global_index1: int, global_index2: int) -> bool
```

**功能描述：** 判断两个位置是否满足配对条件。配对规则基于 NumberMatch 游戏的经典规则：首先检查两个数字是否满足 `can_match`
条件，然后检查两个位置之间是否存在有效的配对路径。

**配对条件（需同时满足）：**

1. **数字匹配条件**（由 `can_match` 判断）：
    - 两个数字必须相同，或两个数字之和为 10
2. **路径可达条件**：
    - 两个位置之间必须没有其他非空数字
    - 配对路径必须满足以下任一条件：
        - 相同行（水平相邻或间隔一至多格）
        - 相同列（垂直相邻或间隔一至多格）
        - 对角线相邻
        - 跨行首尾相邻（两行首尾位置的数字可配对）

**参数：**

| 参数名             | 类型    | 说明                  |
|-----------------|-------|---------------------|
| `global_index1` | `int` | 第一个位置的全局索引（0-based） |
| `global_index2` | `int` | 第二个位置的全局索引（0-based） |

**返回值：** `bool` - 如果两个位置能够配对消除则返回 `True`，否则返回 `False`

**配对规则详解：**

| 规则类型 | 条件                                                          | 说明                 |
|------|-------------------------------------------------------------|--------------------|
| 相同行  | `row_index1 == row_index2`                                  | 同一行内，两个位置之间不能有非空数字 |
| 相同列  | `col_index1 == col_index2`                                  | 同一列内，两个位置之间不能有非空数字 |
| 对角线  | `row1 + col1 == row2 + col2` 或 `row1 - row2 == col1 - col2` | 对角线相邻，两位置之间不能有非空数字 |
| 跨行首尾 | `abs(row1 - row2) == 1`                                     | 相邻两行的首尾位置可配对       |

**使用示例：**

```python
board = Board()
board.set_board([1, 0, 0, 0, 0, 0, 0, 0, 9, 9, 0, 0, 0, 0, 0, 0, 0, 1])

# 相同行配对（1 和 9 和为 10）
print(board._is_matching(0, 8))  # True

# 跨行首尾配对（1 和 1 相同）
print(board._is_matching(0, 17))  # True

# 间隔有数字，无法配对
print(board._is_matching(0, 1))  # False
```

**注意：** 此方法为私有方法，主要供内部 `match()` 方法调用。

---

### `match`

```python
def match(self, global_index1: int, global_index2: int) -> None
```

**功能描述：** 执行配对消除操作。首先调用 `_is_matching()` 判断两个位置是否满足配对条件，如果可以配对，则将两个位置的数字设为
0（表示消除），然后调用 `_clear()` 清理空行。

**参数：**

| 参数名             | 类型    | 说明                  |
|-----------------|-------|---------------------|
| `global_index1` | `int` | 第一个位置的全局索引（0-based） |
| `global_index2` | `int` | 第二个位置的全局索引（0-based） |

**返回值：** `None`

**使用示例：**

```python
board = Board()
board.set_board([1, 2, 3, 4, 5, 6, 7, 8, 9])

# 1 和 9 和为 10，可以配对
board.match(0, 8)
print(board.digit_list)  # [0, 2, 3, 4, 5, 6, 7, 8, 0]
```

---

### `clear`

```python
def _clear(self) -> None
```

**功能描述：** 清理棋盘中的空行。将全为 0 的行从棋盘中移除，保留非空行，并将所有剩余数字压缩到顶部。

**参数：** 无

**返回值：** `None`

**使用示例：**

```python
board = Board()
board.set_board([1, 2, 3, 0, 0, 0, 0, 0, 0,  # 第一行有数字
                 0, 0, 0, 0, 0, 0, 0, 0, 0,  # 第二行为空行
                 4, 5, 6, 0, 0, 0, 0, 0, 0])  # 第三行有数字
board._clear()
# _clear 后 digit_list 变为 [1, 2, 3, 4, 5, 6]，空行被移除
```

**注意：** 此方法为私有方法，通常在 `match()` 操作后自动调用。

---

### `fill`

```python
def fill(self) -> None
```

**功能描述：** 拷贝填充。将棋盘中剩余的非空数字复制到列表末尾，实现数字的填充和重排。

**参数：** 无

**返回值：** `None`

**使用示例：**

```python
board = Board()
board.set_board([1, 2, 0, 3, 0])
board.fill()  # 填充后 digit_list 为 [1, 2, 0, 3, 0, 1, 2, 3]
```

---

### `safe_copy`

```python
def safe_copy(self) -> 'Board'
```

**功能描述：** 创建当前棋盘的安全副本。返回一个新的 `Board` 实例，其 `digit_list` 是原列表的浅拷贝，修改新实例不会影响原实例。

**参数：** 无

**返回值：** `Board` - 新的 Board 实例，包含与原实例相同的数据

**使用示例：**

```python
board1 = Board()
board1.set_board([1, 2, 3, 4, 5, 6, 7, 8, 9])
board2 = board1.safe_copy()

board2.digit_list[0] = 0
print(board1.digit_list[0])  # 1，未受影响
print(board2.digit_list[0])  # 0
```

---

## 配对规则详解

### 数字匹配条件

两个数字可以配对的前提条件（满足任一即可）：

1. **数值相同**：两个位置的数字完全相等
2. **和为 10**：两个位置的数字之和等于 10

### 路径可达条件

在满足数字匹配条件后，还需检查两个位置之间的路径是否通畅：

- 两位置之间不能有非空数字
- 必须满足以下拓扑关系之一：
    - 同一行（水平方向）
    - 同一列（垂直方向）
    - 对角线相邻
    - 相邻两行的首尾位置

### 边界情况

- 相同位置不能配对（`global_index1 == global_index2` 时返回 `False`）
- 任一位置为空（数字为 0）时不能配对
- 跨行首尾配对仅适用于相邻两行

## 方法访问级别说明

本类中的方法按照访问级别分为以下几类：

| 方法名                                                         | 访问级别 | 说明                      |
|-------------------------------------------------------------|------|-------------------------|
| `__init__`, `__str__`                                       | 特殊方法 | Python 特殊方法，用于初始化和字符串表示 |
| `set_board`, `generate_board`, `match`, `fill`, `safe_copy` | 公开   | 公开接口，供外部代码调用            |
| `_can_match`, `_is_matching`, `_clear`                      | 私有   | 内部实现细节，主要供类内部方法使用       |

**设计原则：** 公开方法提供完整的游戏操作接口，私有方法封装内部实现细节，确保类的封装性和可维护性。

## 最佳实践

1. **状态管理：** 在进行批量操作前，使用 `safe_copy()` 创建备份，以便回滚
2. **连续操作：** 配对消除后会自动清理空行，无需额外调用 `_clear()`
3. **界面展示：** 使用 `__str__()` 方法获取棋盘的可视化表示，便于调试和日志输出
